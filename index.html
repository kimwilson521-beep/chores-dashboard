<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Chores Login</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1020">
<style>
  :root{
    --bg:#0b1020; --text:#e8ecff; --muted:#a9b4e6; --line:rgba(255,255,255,.12);
    --shadow:0 18px 50px rgba(0,0,0,.45); --radius:18px;
    --hi:#60a5fa; --ok:#36d399; --bad:#fb7185; --warn:#fbbf24;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh;
    font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,.25), transparent 55%),
      radial-gradient(900px 500px at 90% 0%, rgba(251,113,133,.18), transparent 60%),
      radial-gradient(1000px 700px at 60% 120%, rgba(54,211,153,.14), transparent 60%),
      var(--bg);
    padding:18px;
    display:flex; align-items:flex-start; justify-content:center;
  }
  .card{
    width:min(980px, 100%);
    border:1px solid var(--line);
    border-radius:var(--radius);
    background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    box-shadow:var(--shadow);
    overflow:hidden;
  }
  .top{
    padding:16px 18px;
    border-bottom:1px solid var(--line);
    background:rgba(0,0,0,.12);
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
  }
  h1{margin:0;font-size:18px;letter-spacing:.3px}
  .sub{color:var(--muted);font-size:12.5px;margin-top:6px;line-height:1.35}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:14px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .panel{
    border:1px solid var(--line);
    border-radius:16px;
    background:rgba(0,0,0,.14);
    padding:14px;
  }
  .panel h2{margin:0 0 8px;font-size:14px}
  .muted{color:var(--muted);font-size:12.5px}
  .btn{
    border:1px solid var(--line);
    background:rgba(255,255,255,.06);
    color:var(--text);
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font:inherit;
  }
  .btn:hover{background:rgba(255,255,255,.09)}
  .btn.primary{border-color:rgba(96,165,250,.50);background:rgba(96,165,250,.16)}
  .msg{display:none;margin-top:10px;font-size:12.5px;color:var(--muted)}
  .msg.bad{color:#ffd7df}
  .msg.ok{color:#d8fff0}
  code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace; font-size:11px}
</style>

<!-- Google Identity Services -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="card">
    <div class="top">
      <div>
        <h1>Chores Dashboard Login</h1>
        <div class="sub">Admin uses Google Sign‑In. End user opens their page from here.</div>
      </div>
      <div class="muted">Admin: <b>kimwilson521@gmail.com</b></div>
    </div>

    <div class="grid">
      <!-- Admin -->
      <div class="panel">
        <h2>Admin</h2>
        <div class="muted">Sign in with Google to access admin tools (add/edit/delete).</div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px">
          <div id="gBtn"></div>
          <button class="btn" id="adminLogoutBtn" style="display:none">Logout</button>
        </div>

        <div class="msg" id="adminMsg"></div>
      </div>

      <!-- User -->
      <div class="panel">
        <h2>Maisie</h2>
        <div class="muted">Open the chores dashboard.</div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px">
          <button class="btn primary" id="openUserBtn">Open Maisie chores →</button>
          <button class="btn" id="userLogoutBtn">Logout</button>
        </div>

        <div class="msg" id="userMsg"></div>

        <div class="muted" style="margin-top:12px">
          This sets <code>sessionStorage.user_name</code> for the session (so the Maisie page won't kick you back).
        </div>
      </div>
    </div>
  </div>

<script>
  const ADMIN_EMAIL = "kimwilson521@gmail.com";
  const GOOGLE_CLIENT_ID = "268475007338-dj50bjnkclghg3eaiv3bivh4qu8325mn.apps.googleusercontent.com";
  const ADMIN_PAGE = "admin maise progress calander.html";
  const USER_PAGE = "maise c.html";
  const USER_NAME = "Maisie";

  const el = {
    adminMsg: document.getElementById("adminMsg"),
    userMsg: document.getElementById("userMsg"),
    adminLogoutBtn: document.getElementById("adminLogoutBtn"),
    openUserBtn: document.getElementById("openUserBtn"),
    userLogoutBtn: document.getElementById("userLogoutBtn"),
  };

  function showMsg(box, text, kind){
    box.className = "msg" + (kind ? " " + kind : "");
    box.textContent = text;
    box.style.display = "block";
  }
  function clearMsg(box){
    box.style.display = "none";
    box.textContent = "";
    box.className = "msg";
  }

  // ---- User open ----
  el.openUserBtn.addEventListener("click", ()=>{
    clearMsg(el.userMsg);
    sessionStorage.setItem("user_name", USER_NAME);
    location.href = USER_PAGE;
  });

  el.userLogoutBtn.addEventListener("click", ()=>{
    sessionStorage.removeItem("user_name");
    showMsg(el.userMsg, "Logged out.", "ok");
  });

  // ---- Admin Google Sign-In ----
  function parseJwtEmail(jwt){
    try {
      const payload = jwt.split(".")[1];
      const json = JSON.parse(atob(payload.replace(/-/g,'+').replace(/_/g,'/')));
      return (json.email || "").toLowerCase();
    } catch(e) {
      return "";
    }
  }

  function onGoogleCredential(response){
    clearMsg(el.adminMsg);
    const idToken = response && response.credential ? response.credential : "";
    if(!idToken){
      showMsg(el.adminMsg, "Google sign-in failed (no token).", "bad");
      return;
    }

    const email = parseJwtEmail(idToken);
    if(email !== ADMIN_EMAIL.toLowerCase()){
      showMsg(el.adminMsg, "Not authorised. Sign in with " + ADMIN_EMAIL, "bad");
      return;
    }

    sessionStorage.setItem("admin_token", idToken);
    el.adminLogoutBtn.style.display = "inline-flex";
    showMsg(el.adminMsg, "Signed in ✅ Redirecting…", "ok");
    setTimeout(()=>location.href = ADMIN_PAGE, 450);
  }

  window.addEventListener("load", ()=>{
    if(!window.google || !google.accounts || !google.accounts.id){
      showMsg(el.adminMsg, "Google Sign‑In failed to load. Open in Chrome/Safari.", "bad");
      return;
    }
    google.accounts.id.initialize({
      client_id: GOOGLE_CLIENT_ID,
      callback: onGoogleCredential
    });
    google.accounts.id.renderButton(
      document.getElementById("gBtn"),
      { theme:"outline", size:"large", text:"signin_with", shape:"pill" }
    );
    if(sessionStorage.getItem("admin_token")){
      el.adminLogoutBtn.style.display = "inline-flex";
    }
  });

  el.adminLogoutBtn.addEventListener("click", ()=>{
    sessionStorage.removeItem("admin_token");
    showMsg(el.adminMsg, "Logged out.", "ok");
    el.adminLogoutBtn.style.display = "none";
  });
</script>
</body>
</html>
